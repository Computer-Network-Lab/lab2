<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
    <title>最适合我的语言是<span class="codename"> </span></title>
    <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/holder.min.js"></script>
    <script type="text/javascript" src="js/progress.min.js"></script>
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.5.4.js"></script>
    <link href="css/progressjs.min.css" rel="stylesheet">
    <link href="css/normalize.css" rel="stylesheet">
    <script type="text/javascript">
    (function($) {
        AV.initialize("z06ful0pwqno0smjaf31sfqgsnmecr7fc3cpqhb9vxiqilvm", "qxvgd6ye1gl99jpkinor71mhbc77m9plwzoi4hrwdiy4j9rd");
        $.getUrlParam = function(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }
    })(jQuery);
    </script>
    <!-- CSS  -->
    <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection" />
    <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection" />
    <style type="text/css" media="screen">
    .user {
        width: 120px;
        height: 120px;
    }

    .autoheight {
        height: 600px;
    }

    .nofile {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        width: 100%;
        margin: 0;
        padding: 0;
        font-size: 20px;
        cursor: pointer;
        opacity: 0;
        filter: alpha(opacity=0);
    }
    </style>
</head>

<body>
    <script type="text/javascript">
    var YOUR_API_SECRET = "JKQ3s2IcDA-wtV1LPId8J-s2t03YoMYk";
    var YOUR_API_KEY = "d24b4f4288a33e51692e89d847de569b";
    var FACESET = "faceset";

    var desc = {
        "c++": "c++是世界上最好的编程语言！",
        "java": "java是世界上最好的编程语言！",
        "css": "css是世界上最好的编程语言！",
        "ruby": "ruby是世界上最好的编程语言！",
        "javascript": "javascript是世界上最好的编程语言！",
        "c": "c是世界上最好的编程语言！",
        "666": "77777777"
    }

    var detectUrl = "https://apicn.faceplusplus.com/v2/detection/detect?";
    var searchUrl = "https://apicn.faceplusplus.com/v2/recognition/search?";
    var getFaceUrl = "https://apicn.faceplusplus.com/v2/info/get_face?";
    </script>
    <nav class="white" role="navigation">
        <div class="nav-wrapper container">
            <a id="logo-container" href="#" class="brand-logo">CodeFace</a>
        </div>
    </nav>
    <div id="index-banner" class="parallax-container autoheight">
        <div class="section no-pad-bot">
            <div class="container">
                <br>
                <br>
                <div class="center row">
                    <div class="col s6 m6">
                        <img id="faceImg" src="holder.js/150x150" class="circle user " />
                    </div>
                    <div class="col s6 m6">
                        <img id="searchImg" src="holder.js/150x150" class="circle user" />
                    </div>
                </div>
                <h1 class="header center teal-text text-lighten-2" id="conclusion">最适合我的语言是<span class="codename"> </span></h1>
                <div class="row center">
                    <h5 class="header col s12 light" id="statement">我和著名 <span class="codename"> </span> 程序猿 <a href="" id="coder">liudangyi</a> 比较像</h5>
                </div>
                <div class="row center">
                    <form id="imageForm" enctype="multipart/form-data">
                        <div class="btn-large waves-effect waves-light teal lighten-1">
                            <input class="btn-large waves-effect waves-light teal lighten-1 nofile" type="file" id="img">快来测测你比较适合哪种编程语言！</input>
                        </div>
                    </form>
                </div>
                <br>
                <br>
            </div>
        </div>
        <div class="parallax"><img src="background1.jpg" alt="Unsplashed background img 2"></div>
    </div>
    <script type="text/javascript">
    var faceid = $.getUrlParam("face");
    var searchid = $.getUrlParam("search");
    var code = $.getUrlParam("code");
    var name = $.getUrlParam("name");

    if (faceid != null) {
        console.log(faceid);
        var faceparam = {
            face_id: faceid,
            api_key: YOUR_API_KEY,
            api_secret: YOUR_API_SECRET
        }
        $.ajax({
            url: getFaceUrl + $.param(faceparam),
            type: 'get',
            success: function(data) {
                console.log(data.face_info[0].url);
                $('#faceImg').attr("src", data.face_info[0].url);
            },
            error: function() {
                alert("...");
            }
        });
    }

    if (searchid != null) {
        var searchparam = {
            face_id: searchid,
            api_key: YOUR_API_KEY,
            api_secret: YOUR_API_SECRET
        }
        $.ajax({
            url: getFaceUrl + $.param(searchparam),
            type: 'get',
            success: function(data) {
                console.log(data.face_info[0].url);
                $('#searchImg').attr("src", data.face_info[0].url);
            },
            error: function() {
                alert("......");
            }
        });
    }

    if (code != null) {
        $('.codename').html(code);
    } else {
        $('.codename').html("C++");
    }

    if (name != null) {
        $('#coder').html(name);
        $('#coder').attr("href", "https://github.com/" + name);
    } else {
        $('#coder').html('liudangyi');
        $('#coder').attr("href", "https://github.com/liudangyi");
    }
    </script>
    <script type="text/javascript">
    $(function() {
        var UserImage = AV.Object.extend("UserImage");
        $("#imageForm").on('submit', function(e) {
            e.preventDefault();
            progressJs().setOptions({
                overlayMode: true,
                theme: 'blueOverlay'
            }).start().autoIncrease(10, 500);
            var userImage = new UserImage();
            var image = new AV.File($('#img')[0].files[0].name, $('#img')[0].files[0]);
            userImage.set("image", image);
            userImage.save();
            image.save().then(function() {
            	progressJs().set(200);
            	var detectParams = {
                	api_secret: YOUR_API_SECRET,
                	api_key: YOUR_API_KEY,
                	url: userImage.get("image").url(),
            	};
                var detect = $.ajax({
                    url: detectUrl + $.param(detectParams),
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function(data) {
                    	progressJs().set(300);
                        console.log(data);
                        var key_face_id = data.face[0].face_id;
                        console.log('FACESET' + FACESET);
                        var searchParams = {
                            api_secret: YOUR_API_SECRET,
                            api_key: YOUR_API_KEY,
                            key_face_id: key_face_id,
                            faceset_name: FACESET
                        };

                        var search = $.ajax({
                            url: searchUrl + $.param(searchParams),
                            type: 'get',
                            success: function(data) {
                            	progressJs().set(400);
                                console.log(data);
                                var faceid = data.candidate[0].face_id;
                                var tagarray = data.candidate[0].tag.split(":");
                                var tagname = tagarray[1].split(",")[0];
                                var tagcode = tagarray[2].split("}")[0];
                                userImage.set("faceID", faceid);
                                userImage.save();
                                progressJs().end();

                                var newParams = {
                                    face: key_face_id,
                                    search: faceid,
                                    code: tagcode,
                                    name: tagname
                                }

                                window.location.href = "index.html?" + $.param(newParams);

                            },
                            error: function() {
                                //alert("ooops!!!");
                            }
                        });
                    },
                    error: function() {
                        //alert("ops!!!");
                    }
                });
            }, function(error) {
                // Upload error
            });
        });
        $("#img").on('change', function(e) {
            $("#imageForm").submit();
        })
    });
    </script>
    <div class="container">
        <div class="section">
            <!--   Icon Section   -->
            <div class="row">
                <div class="col s12 m4">
                    <div class="icon-block">
                        <h2 class="center brown-text"><i class="mdi-image-flash-on"></i></h2>
                        <h5 class="center">Speeds up development</h5>
                        <p class="light">We did most of the heavy lifting for you to provide a default stylings that incorporate our custom components. Additionally, we refined animations and transitions to provide a smoother experience for developers.</p>
                    </div>
                </div>
                <div class="col s12 m4">
                    <div class="icon-block">
                        <h2 class="center brown-text"><i class="mdi-social-group"></i></h2>
                        <h5 class="center">User Experience Focused</h5>
                        <p class="light">By utilizing elements and principles of Material Design, we were able to create a framework that incorporates components and animations that provide more feedback to users. Additionally, a single underlying responsive system across all platforms allow for a more unified user experience.</p>
                    </div>
                </div>
                <div class="col s12 m4">
                    <div class="icon-block">
                        <h2 class="center brown-text"><i class="mdi-action-settings"></i></h2>
                        <h5 class="center">Easy to work with</h5>
                        <p class="light">We have provided detailed documentation as well as specific code examples to help new users get started. We are also always open to feedback and can answer any questions a user may have about Materialize.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="parallax-container valign-wrapper">
        <div class="section no-pad-bot">
            <div class="container">
                <div class="row center">
                    <h5 class="header col s12 light">A modern responsive front-end framework based on Material Design</h5>
                </div>
            </div>
        </div>
        <div class="parallax"><img src="background2.jpg" alt="Unsplashed background img 3"></div>
    </div>
    <footer class="page-footer teal">
        <div class="container">
            <div class="row">
                <div class="col l6 s12">
                    <h5 class="white-text">Company Bio</h5>
                    <p class="grey-text text-lighten-4">We are a team of college students working on this project like it's our full time job. Any amount would help support and continue development on this project and is greatly appreciated.</p>
                </div>
                <div class="col l3 s12">
                    <h5 class="white-text">Settings</h5>
                    <ul>
                        <li><a class="white-text" href="#!">Link 1</a></li>
                        <li><a class="white-text" href="#!">Link 2</a></li>
                        <li><a class="white-text" href="#!">Link 3</a></li>
                        <li><a class="white-text" href="#!">Link 4</a></li>
                    </ul>
                </div>
                <div class="col l3 s12">
                    <h5 class="white-text">Connect</h5>
                    <ul>
                        <li><a class="white-text" href="#!">Link 1</a></li>
                        <li><a class="white-text" href="#!">Link 2</a></li>
                        <li><a class="white-text" href="#!">Link 3</a></li>
                        <li><a class="white-text" href="#!">Link 4</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            <div class="container">
                Made by <a class="brown-text text-lighten-3" href="http://materializecss.com">Materialize</a>
            </div>
        </div>
    </footer>
    <!--  Scripts-->
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="js/materialize.js"></script>
    <script src="js/init.js"></script>
</body>

</html>
